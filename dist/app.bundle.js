!function(e){function t(t){for(var r,o,i=t[0],a=t[1],u=t[2],s=0,l=[];s<i.length;s++)o=i[s],I[o]&&l.push(I[o][0]),I[o]=0;for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r]);for(R&&R(t);l.length;)l.shift()();return S.push.apply(S,u||[]),n()}function n(){for(var e,t=0;t<S.length;t++){for(var n=S[t],r=!0,o=1;o<n.length;o++){var i=n[o];0!==I[i]&&(r=!1)}r&&(S.splice(t--,1),e=j(j.s=n[0]))}return e}var r=window.webpackHotUpdate;window.webpackHotUpdate=function(e,t){!function(e,t){if(!E[e]||!w[e])return;for(var n in w[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(v[n]=t[n]);0==--m&&0===_&&M()}(e,t),r&&r(e,t)};var o,i=!0,a="f7fe1c37372bbe443331",u=1e4,s={},l=[],c=[];var d=[],f="idle";function h(e){f=e;for(var t=0;t<d.length;t++)d[t].call(null,e)}var p,v,y,m=0,_=0,b={},w={},E={};function g(e){return+e+""===e?+e:e}function k(e){if("idle"!==f)throw new Error("check() is only allowed in idle status");return i=e,h("check"),function(e){return e=e||1e4,new Promise(function(t,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,o=j.p+""+a+".hot-update.json";r.open("GET",o,!0),r.timeout=e,r.send(null)}catch(e){return n(e)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+o+" timed out."));else if(404===r.status)t();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+o+" failed."));else{try{var e=JSON.parse(r.responseText)}catch(e){return void n(e)}t(e)}}})}(u).then(function(e){if(!e)return h("idle"),null;w={},b={},E=e.c,y=e.h,h("prepare");var t=new Promise(function(e,t){p={resolve:e,reject:t}});for(var n in v={},I)C(n);return"prepare"===f&&0===_&&0===m&&M(),t})}function C(e){E[e]?(w[e]=!0,m++,function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.charset="utf-8",n.src=j.p+""+e+"."+a+".hot-update.js",t.appendChild(n)}(e)):b[e]=!0}function M(){h("ready");var e=p;if(p=null,e)if(i)Promise.resolve().then(function(){return O(i)}).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var n in v)Object.prototype.hasOwnProperty.call(v,n)&&t.push(g(n));e.resolve(t)}}function O(t){if("ready"!==f)throw new Error("apply() is only allowed in ready status");var n,r,o,i,u;function c(e){for(var t=[e],n={},r=t.slice().map(function(e){return{chain:[e],id:e}});r.length>0;){var o=r.pop(),a=o.id,u=o.chain;if((i=T[a])&&!i.hot._selfAccepted){if(i.hot._selfDeclined)return{type:"self-declined",chain:u,moduleId:a};if(i.hot._main)return{type:"unaccepted",chain:u,moduleId:a};for(var s=0;s<i.parents.length;s++){var l=i.parents[s],c=T[l];if(c){if(c.hot._declinedDependencies[a])return{type:"declined",chain:u.concat([l]),moduleId:a,parentId:l};-1===t.indexOf(l)&&(c.hot._acceptedDependencies[a]?(n[l]||(n[l]=[]),d(n[l],[a])):(delete n[l],t.push(l),r.push({chain:u.concat([l]),id:l})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}t=t||{};var p={},m=[],_={},b=function(){console.warn("[HMR] unexpected require("+k.moduleId+") to disposed module")};for(var w in v)if(Object.prototype.hasOwnProperty.call(v,w)){var k;u=g(w);var C=!1,M=!1,O=!1,S="";switch((k=v[w]?c(u):{type:"disposed",moduleId:w}).chain&&(S="\nUpdate propagation: "+k.chain.join(" -> ")),k.type){case"self-declined":t.onDeclined&&t.onDeclined(k),t.ignoreDeclined||(C=new Error("Aborted because of self decline: "+k.moduleId+S));break;case"declined":t.onDeclined&&t.onDeclined(k),t.ignoreDeclined||(C=new Error("Aborted because of declined dependency: "+k.moduleId+" in "+k.parentId+S));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(k),t.ignoreUnaccepted||(C=new Error("Aborted because "+u+" is not accepted"+S));break;case"accepted":t.onAccepted&&t.onAccepted(k),M=!0;break;case"disposed":t.onDisposed&&t.onDisposed(k),O=!0;break;default:throw new Error("Unexception type "+k.type)}if(C)return h("abort"),Promise.reject(C);if(M)for(u in _[u]=v[u],d(m,k.outdatedModules),k.outdatedDependencies)Object.prototype.hasOwnProperty.call(k.outdatedDependencies,u)&&(p[u]||(p[u]=[]),d(p[u],k.outdatedDependencies[u]));O&&(d(m,[k.moduleId]),_[u]=b)}var P,D=[];for(r=0;r<m.length;r++)u=m[r],T[u]&&T[u].hot._selfAccepted&&D.push({module:u,errorHandler:T[u].hot._selfAccepted});h("dispose"),Object.keys(E).forEach(function(e){!1===E[e]&&function(e){delete I[e]}(e)});for(var L,R,H=m.slice();H.length>0;)if(u=H.pop(),i=T[u]){var x={},U=i.hot._disposeHandlers;for(o=0;o<U.length;o++)(n=U[o])(x);for(s[u]=x,i.hot.active=!1,delete T[u],delete p[u],o=0;o<i.children.length;o++){var Z=T[i.children[o]];Z&&((P=Z.parents.indexOf(u))>=0&&Z.parents.splice(P,1))}}for(u in p)if(Object.prototype.hasOwnProperty.call(p,u)&&(i=T[u]))for(R=p[u],o=0;o<R.length;o++)L=R[o],(P=i.children.indexOf(L))>=0&&i.children.splice(P,1);for(u in h("apply"),a=y,_)Object.prototype.hasOwnProperty.call(_,u)&&(e[u]=_[u]);var A=null;for(u in p)if(Object.prototype.hasOwnProperty.call(p,u)&&(i=T[u])){R=p[u];var N=[];for(r=0;r<R.length;r++)if(L=R[r],n=i.hot._acceptedDependencies[L]){if(-1!==N.indexOf(n))continue;N.push(n)}for(r=0;r<N.length;r++){n=N[r];try{n(R)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:u,dependencyId:R[r],error:e}),t.ignoreErrored||A||(A=e)}}}for(r=0;r<D.length;r++){var K=D[r];u=K.module,l=[u];try{j(u)}catch(e){if("function"==typeof K.errorHandler)try{K.errorHandler(e)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:n,originalError:e}),t.ignoreErrored||A||(A=n),A||(A=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:u,error:e}),t.ignoreErrored||A||(A=e)}}return A?(h("fail"),Promise.reject(A)):(h("idle"),new Promise(function(e){e(m)}))}var T={},I={0:0},S=[];function j(t){if(T[t])return T[t].exports;var n=T[t]={i:t,l:!1,exports:{},hot:function(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:o!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._acceptedDependencies[e[r]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:k,apply:O,status:function(e){if(!e)return f;d.push(e)},addStatusHandler:function(e){d.push(e)},removeStatusHandler:function(e){var t=d.indexOf(e);t>=0&&d.splice(t,1)},data:s[e]};return o=void 0,t}(t),parents:(c=l,l=[],c),children:[]};return e[t].call(n.exports,n,n.exports,function(e){var t=T[e];if(!t)return j;var n=function(n){return t.hot.active?(T[n]?-1===T[n].parents.indexOf(e)&&T[n].parents.push(e):(l=[e],o=n),-1===t.children.indexOf(n)&&t.children.push(n)):(console.warn("[HMR] unexpected require("+n+") from disposed module "+e),l=[]),j(n)},r=function(e){return{configurable:!0,enumerable:!0,get:function(){return j[e]},set:function(t){j[e]=t}}};for(var i in j)Object.prototype.hasOwnProperty.call(j,i)&&"e"!==i&&"t"!==i&&Object.defineProperty(n,i,r(i));return n.e=function(e){return"ready"===f&&h("prepare"),_++,j.e(e).then(t,function(e){throw t(),e});function t(){_--,"prepare"===f&&(b[e]||C(e),0===_&&0===m&&M())}},n.t=function(e,t){return 1&t&&(e=n(e)),j.t(e,-2&t)},n}(t)),n.l=!0,n.exports}j.m=e,j.c=T,j.d=function(e,t,n){j.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},j.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},j.t=function(e,t){if(1&t&&(e=j(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(j.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)j.d(n,r,function(t){return e[t]}.bind(null,r));return n},j.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return j.d(t,"a",t),t},j.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},j.p="dist/",j.h=function(){return a};var P=window.webpackJsonp=window.webpackJsonp||[],D=P.push.bind(P);P.push=t,P=P.slice();for(var L=0;L<P.length;L++)t(P[L]);var R=D;S.push([11,1]),n()}([,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=t.CHUNK_SIZE=16,i=(t.TILE_SIZE=32,t.BORDER_NORTH=8,t.BORDER_WEST=1,t.BORDER_SOUTH=2,t.BORDER_EAST=4,t.BORDER_ALL=15,function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.chunkCoordX=t,this.chunkCoordY=n,this._activeTime=0,this._dirty=!1,this._tiles=new Uint8Array(o*o),this._metas=new Uint8Array(o*o)}return r(e,[{key:"update",value:function(){if(this._dirty)for(var e=void 0,t=void 0,n=void 0,r=void 0,i=void 0,a=this._tiles.length,u=0;u<a;++u)this._tiles[u]<=0||(e=0,t=u-o,n=u+o,i=u+1,(r=u-1)>=0&&r<a&&this._tiles[r]<=0&&(e|=1),n>=0&&n<a&&this._tiles[n]<=0&&(e|=2),i>=0&&i<a&&this._tiles[i]<=0&&(e|=4),t>=0&&t<a&&this._tiles[t]<=0&&(e|=8),this._metas[u]=e)}},{key:"setTile",value:function(e,t,n){e<0||e>o||t<0||t>o||(this._tiles[e+t*o]=n,this._dirty=!0)}},{key:"setMetadata",value:function(e,t,n){e<0||e>o||t<0||t>o||(this._metas[e+t*o]=n,this._dirty=!0)}},{key:"getTile",value:function(e,t){return e<0||e>o?0:t<0||t>o?0:this._tiles[e+t*o]}},{key:"getMetadata",value:function(e,t){return e<0||e>o?0:t<0||t>o?0:this._metas[e+t*o]}},{key:"setActiveTime",value:function(e){this._activeTime=e}},{key:"getLastActiveTime",value:function(){return this._activeTime}}]),e}());t.default=i},function(e,t,n){(e.exports=n(8)(!1)).push([e.i,"body {\n  font-family: sans-serif;\n\n  pointer-events: none;\n}\n\n#root {\n  width: 100%;\n  height: 100%;\n\n  --toolbar-size: 5em;\n}\n\n.app-container {\n  display: flex;\n  flex-direction: row;\n\n  width: 100%;\n  height: 100%;\n}\n\n.viewport {\n  position: relative;\n\n  width: 100%;\n  height: 100%;\n\n  pointer-events: none;\n  outline: 2px dotted black;\n}\n.viewport > * {\n  pointer-events: auto;\n}\n\n#theCanvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: -1;\n  width: 100%;\n  height: 100%;\n\n  pointer-events: auto;\n}\n",""])},function(e,t,n){(e.exports=n(8)(!1)).push([e.i,".toolbar-container {\n  display: flex;\n  flex-direction: column;\n\n  width: var(--toolbar-size);\n  height: 100%;\n\n  pointer-events: auto;\n}\n\n.toolbar-container > button {\n  cursor: pointer;\n}\n",""])},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tileMapping=new Map}return r(e,[{key:"registerTile",value:function(e,t){return this.tileMapping.set(e,t),t.setID(e),t}},{key:"getTile",value:function(e){return this.tileMapping.get(e)}}]),e}();t.default=new o},function(e,t,n){"use strict";var r=a(n(0)),o=a(n(13)),i=a(n(21));function a(e){return e&&e.__esModule?e:{default:e}}window.addEventListener("load",function(e){u=document.getElementById("root"),window.requestAnimationFrame(c)}),window.addEventListener("beforeunload",function(e){});var u,s=60,l=0;function c(e){(e-l)/s,o.default.render(r.default.createElement(i.default),u),l=e,window.requestAnimationFrame(c)}},,,,,,,,,,function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=l(n(0)),i=n(23);n(25);var a=l(n(27)),u=l(n(29)),s=l(n(30));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.canvas=null,n.inputController=new u.default,n.world=new s.default,n.onWindowResize=n.onWindowResize.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default.Component),r(t,[{key:"onWindowResize",value:function(e){this.canvas.setAttribute("width",this.canvas.offsetWidth),this.canvas.setAttribute("height",this.canvas.offsetHeight)}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onWindowResize),this.onWindowResize(null),this.inputController.initialize(this),this.world.initialize(this)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onWindowResize),this.world.destroy(),this.inputController.destroy()}},{key:"componentDidUpdate",value:function(){this.world.update()}},{key:"render",value:function(){var e=this;return o.default.createElement("div",{className:"app-container"},o.default.createElement(a.default,null,o.default.createElement("button",null,"New"),o.default.createElement("button",null,"Load"),o.default.createElement("button",null,"Save"),o.default.createElement("button",{onClick:function(t){e.world.tileMode="add"==e.world.tileMode?"subtract":"add"}},"Add/Subtract")),o.default.createElement("div",{className:"viewport"},o.default.createElement("h1",null,"DraftStone"),o.default.createElement("canvas",{id:"theCanvas",ref:function(t){return e.canvas=t}})))}}]),t}();t.default=(0,i.hot)(e)(c)}).call(this,n(22)(e))},,,,function(e,t,n){var r=n(2);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0},i=n(9)(r,o);r.locals&&(e.exports=r.locals),e.hot.accept(2,function(){var t=n(2);if("string"==typeof t&&(t=[[e.i,t,""]]),!function(e,t){var n,r=0;for(n in e){if(!t||e[n]!==t[n])return!1;r++}for(n in t)r--;return 0===r}(r.locals,t.locals))throw new Error("Aborting CSS HMR due to changed css-modules locals.");i(t)}),e.hot.dispose(function(){i()})},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(0));n(28);var i=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default.Component),r(t,[{key:"render",value:function(){return o.default.createElement("div",{className:"toolbar-container"},this.props.children)}}]),t}();t.default=i},function(e,t,n){var r=n(3);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0},i=n(9)(r,o);r.locals&&(e.exports=r.locals),e.hot.accept(3,function(){var t=n(3);if("string"==typeof t&&(t=[[e.i,t,""]]),!function(e,t){var n,r=0;for(n in e){if(!t||e[n]!==t[n])return!1;r++}for(n in t)r--;return 0===r}(r.locals,t.locals))throw new Error("Aborting CSS HMR due to changed css-modules locals.");i(t)}),e.hot.dispose(function(){i()})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=null,this.pointer={x:0,y:0,down:!1,_mouseup:!1,_mousemove:!1},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}return r(e,[{key:"initialize",value:function(e){this.canvas=e.canvas,this.canvas.addEventListener("mousedown",this.onMouseDown)}},{key:"destroy",value:function(){this.canvas.removeEventListener("mousedown",this.onMouseDown),this.pointer._mouseup&&(document.removeEventListener("mouseup",this.onMouseUp),this.pointer_mouseup=!1),this.pointer._mousemove&&(document.removeEventListener("mousemove",this.onMouseMove),this.pointer._mousemove=!1),this.canvas=null}},{key:"getPointer",value:function(){return this.pointer}},{key:"onMouseDown",value:function(e){this.pointer.down=!0;var t=this.canvas.getBoundingClientRect();this.pointer.x=e.clientX-t.left,this.pointer.y=e.clientY-t.top,this.pointer._mouseup&&(document.removeEventListener("mouseup",this.onMouseUp),this.pointer._mouseup=!1),this.pointer._mousemove&&(document.removeEventListener("mousemove",this.onMouseMove),this.pointer._mousemove=!1),this.pointer._mouseup=!0,document.addEventListener("mouseup",this.onMouseUp),this.pointer._mousemove=!0,document.addEventListener("mousemove",this.onMouseMove)}},{key:"onMouseUp",value:function(e){this.pointer.down=!1,this.pointer._mouseup&&(document.removeEventListener("mouseup",this.onMouseUp),this.pointer._mouseup=!1),this.pointer._mousemove&&(document.removeEventListener("mousemove",this.onMouseMove),this.pointer._mousemove=!1)}},{key:"onMouseMove",value:function(e){var t=this.canvas.getBoundingClientRect();this.pointer.x=e.clientX-t.left,this.pointer.y=e.clientY-t.top}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=l(n(31)),i=n(1),a=l(n(33)),u=l(n(10)),s=l(n(34));function l(e){return e&&e.__esModule?e:{default:e}}u.default.registerTile(1,new a.default);var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=null,this.canvasContext=null,this.inputController=null,this.tileMode="add",this.chunkManager=new o.default,this.mapRenderer=new s.default}return r(e,[{key:"initialize",value:function(e){this.canvas=e.canvas,this.canvasContext=this.canvas.getContext("2d"),this.inputController=e.inputController}},{key:"destroy",value:function(){this.canvasContext=null,this.canvas=null,this.inputController=null}},{key:"update",value:function(){var e=this.canvasContext;e.clearRect(0,0,this.canvas.width,this.canvas.height),e.save(),e.lineWidth=8,e.strokeRect(0,0,this.canvas.width,this.canvas.height),e.restore();var t=this.inputController.getPointer();if(t.down){var n=this.chunkManager.getCursor(),r=i.TILE_SIZE/2;n.setWorldPosition(t.x-r,t.y-r);var o="add"==this.tileMode?1:0;n.setTile(o),n.move(1,0).setTile(o).move(-1,0),n.move(0,1).setTile(o).move(0,-1),n.move(1,1).setTile(o).move(-1,-1)}this.chunkManager.update(),this.mapRenderer.render(e,this.chunkManager.chunks.values())}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=u(n(1)),a=u(n(32));function u(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.chunks=new Map,this.nullChunk=new i.default(this),this.cursor=new a.default(this)}return o(e,[{key:"update",value:function(){var e=this.getCurrentChunkTime(),t=!0,n=!1,o=void 0;try{for(var i,a=this.chunks[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var u=i.value,s=r(u,2),l=s[0],c=s[1];e-c.getLastActiveTime()>5e3?this.chunks.delete(l):c.update()}}catch(e){n=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw o}}}},{key:"getCursor",value:function(){return this.cursor}},{key:"getChunk",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=l(e,t);if(this.chunks.has(r)){var o=this.chunks.get(r);return n&&o.setActiveTime(this.getCurrentChunkTime()),o}return n?this.loadChunk(e,t):this.nullChunk}},{key:"loadChunk",value:function(e,t){var n=l(e,t);if(this.chunks.has(n))throw new Error("Found chunk already loaded at ("+e+", "+t+")");var r=new i.default(e,t);return r.setActiveTime(this.getCurrentChunkTime()),this.chunks.set(n,r),r}},{key:"unloadChunk",value:function(e,t){var n=l(e,t);if(this.chunks.has(n)){var r=this.chunks.get(n);return this.chunks.delete(n),r}throw new Error("Cannot find loaded chunk at ("+e+", "+t+")")}},{key:"isChunkLoaded",value:function(e,t){var n=l(e,t);return this.chunks.has(n)}},{key:"getCurrentChunkTime",value:function(){return Date.now()}}]),e}();function l(e,t){return 53*(53+c(e))+c(t)}function c(e){return e=3042594569^(e=(e=(e=(e=3345072700^(e=e+2127912214+(e<<12))^e>>19)+374761393+(e<<5))+3550635116^e<<9)+4251993797+(e<<3))^e>>16}t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.chunkManager=t,this.chunk=null,this.chunkCoordX=0,this.chunkCoordY=0,this.tileCoordX=0,this.tileCoordY=0}return r(e,[{key:"setWorldPosition",value:function(e,t){return e=Math.floor(e/o.TILE_SIZE),t=Math.floor(t/o.TILE_SIZE),this.chunkCoordX=Math.floor(e/o.CHUNK_SIZE),this.chunkCoordY=Math.floor(t/o.CHUNK_SIZE),this.tileCoordX=e%o.CHUNK_SIZE,this.tileCoordY=t%o.CHUNK_SIZE,this.chunk=this.chunkManager.getChunk(this.chunkCoordX,this.chunkCoordY),this}},{key:"move",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0!=e&&(this.tileCoordX+=e%o.CHUNK_SIZE,this.chunkCoordX+=Math.floor(this.tileCoordX/o.CHUNK_SIZE)),0!=t&&(this.tileCoordY+=t%o.CHUNK_SIZE,this.chunkCoordY+=Math.floor(this.tileCoordY/o.CHUNK_SIZE)),this.chunk=this.chunkManager.getChunk(this.chunkCoordX,this.chunkCoordY),this}},{key:"setTile",value:function(e){return this.chunk.setTile(this.tileCoordX,this.tileCoordY,e),this}},{key:"getTile",value:function(){return this.chunk.getTile(this.tileCoordX,this.tileCoordY)}},{key:"getChunk",value:function(){return this.chunk}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"slategray",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"black",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=-1,this.mainColor=t,this.wallColor=n,this.shadowColor=r}return r(e,[{key:"setID",value:function(e){this.id=e}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(function(e){e&&e.__esModule}(n(10)),n(1));var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"renderMapArray",value:function(e,t){for(var n=t.length,r=0;r<n;++r)t[r]>0&&e.fillRect(r%o.CHUNK_SIZE*o.TILE_SIZE,Math.floor(r/o.CHUNK_SIZE)*o.TILE_SIZE,o.TILE_SIZE,o.TILE_SIZE)}},{key:"renderMapLayer",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=void 0,a=void 0,u=void 0,s=void 0,l=o.TILE_SIZE,c=t._tiles,d=t._metas,f=c.length,h=0;h<f;++h)i=c[h],a=d[h],i>0&&(n<=0||(a&n)>0)&&(u=h%o.CHUNK_SIZE*o.TILE_SIZE,s=Math.floor(h/o.CHUNK_SIZE)*o.TILE_SIZE,r&&a>0&&(e.lineWidth=4,e.beginPath(),e.moveTo(u,s),(a&o.BORDER_NORTH)>0?e.lineTo(u+l,s):e.moveTo(u+l,s),(a&o.BORDER_EAST)>0?e.lineTo(u+l,s+l):e.moveTo(u+l,s+l),(a&o.BORDER_SOUTH)>0?e.lineTo(u,s+l):e.moveTo(u,s+l),(a&o.BORDER_WEST)>0?e.lineTo(u,s):e.moveTo(u,s),e.stroke()),e.fillRect(u,s,l,l))}},{key:"renderChunk",value:function(e,t){e.save(),e.translate(t.chunkCoordX*o.CHUNK_SIZE*o.TILE_SIZE,t.chunkCoordY*o.CHUNK_SIZE*o.TILE_SIZE);for(var n=Math.floor(2*o.TILE_SIZE/3),r=Math.floor(2*n/3),i=1;i<o.CHUNK_SIZE;++i)e.beginPath(),e.moveTo(i*o.TILE_SIZE,0),e.lineTo(i*o.TILE_SIZE,o.CHUNK_SIZE*o.TILE_SIZE),e.moveTo(0,i*o.TILE_SIZE),e.lineTo(o.CHUNK_SIZE*o.TILE_SIZE,i*o.TILE_SIZE),e.stroke();e.fillStyle="lightgray",e.translate(r,0),this.renderMapLayer(e,t,o.BORDER_EAST),e.translate(-r,0),e.fillStyle="black",this.renderMapLayer(e,t,o.BORDER_SOUTH),e.fillStyle="gold",e.translate(0,-n),this.renderMapLayer(e,t),e.translate(0,n),e.restore()}},{key:"render",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var u=i.value;this.renderChunk(e,u)}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}}}]),e}();t.default=i}]);